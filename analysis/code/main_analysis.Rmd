---
title: "GfK Singapore - RQs"
output:
  html_document: default
  pdf_document: default
date: "`r format(Sys.time(), '%d %B %Y')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

require(data.table)
require(stargazer)
library(knitr)
require(xtable)
require(texreg)
library(sjstats)

options(xtable.comment = FALSE)


tableno<<-0
figureno<<-0
fig<-function(caption) {figureno<<-figureno+1;paste0('Figure ', figureno, ': ', caption)}
tab<-function(caption) {tableno<<-tableno+1;paste0('Table ', tableno, ': ', caption)}
```

# Sample overview
```{r sample_overview, echo=FALSE, results='asis'}

tmp=elast[, list(ncountries=length(unique(country)), ncategories=length(unique(category))), by = c('brand')]
setorderv(tmp, c('ncountries','ncategories'),order=-1L)
print(xtable(tmp, caption=tab('Overview of selected brands (need to be active in at least three countries)')), type='html',caption.placement='top')

```


## Elasticities for brand selection

```{r elast_overall, echo = FALSE, results='asis'}
  .vars=c('llen','wpswdst','rwpspr','nov6sh')
	
  zval=1.64
	tmp=elast[!is.na(elast), list(median_elast = median(elast), 
												  w_elast = sum(elast/elast_se)/sum(1/elast_se), 
												  N_brands= .N, 
												  perc_positive = length(which(elast/elast_se>=(zval)))/.N, 
												  perc_null = length(which(abs(elast/elast_se)<zval))/.N, 
												  perc_negative = length(which(elast/elast_se<=(-zval)))/.N), by=c('variable')]
	kable(tmp[match(.vars, variable)], caption = tab('Short-term elasticities by variable for all brands (significance tested at p<.1 (z >= 1.64).'))
	
  zval=1.64
	tmp=elast[!is.na(elastlt), list(median_elast = median(elastlt), 
												  w_elast = sum(elastlt/elastlt_se)/sum(1/elastlt_se), 
												  N_brands= .N, 
												  perc_positive = length(which(elastlt/elastlt_se>=(zval)))/.N, 
												  perc_null = length(which(abs(elastlt/elastlt_se)<zval))/.N, 
												  perc_negative = length(which(elastlt/elastlt_se<=(-zval)))/.N), by=c('variable')]
	kable(tmp[match(.vars, variable)], caption = tab('Long-term elasticities by variable for all brands (significance tested at p<.1 (z >= 1.64).'))
	

```

# R1: Are marketing elasticities really different in EMs vs developed markets?
```{r rq1, echo = FALSE}
### ANALYSIS 1: elasticities different in high versus low

for (var in unique(elast$variable)) {
  cat(paste0('=====================================\n', var,'\n=====================================\n\n'))
  
  cat('- SHORT TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elast, elast[country_class=='linc' & variable == var]$elast))
  cat('- LONG TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elastlt, elast[country_class=='linc' & variable == var]$elastlt))
}
```

```{r rq1b, echo = FALSE}

for (var in unique(elast$variable)) {
  cat(paste0('=====================================\n', var,'\n=====================================\n\n'))
  
  m<-lm(elast~gdppercap + as.factor(category) + as.factor(brand), data = elast, subset = variable==var)
  print(summary(m))
  
  # + long term
}
 # cat('- SHORT TERM -\n')
  #print(t.test(elast[country_class=='hinc' & variable == var]$elast, elast[country_class=='linc' & variable == var]$elast))
  #cat('- LONG TERM -\n')
  #print(t.test(elast[country_class=='hinc' & variable == var]$elastlt, elast[country_class=='linc' & #variable == var]$elastlt))
```


# R2: Can we assume that marketing mix elasticities are the same within EMs or do they differ across EMs?

(intercepts are China)

```{r rq2, echo = FALSE}

for (var in unique(elast$variable)) {
  cat(paste0('=====================================\n', var,'\n=====================================\n\n'))
  
  cat('- SHORT TERM -\n')
  m<-lm(elast~as.factor(country) + as.factor(category) + as.factor(brand), data=elast, subset=country_class=='linc'&variable==var)
  res=data.table(summary(m)$coefficients)
  res[, variable:=rownames(summary(m)$coefficients)]
  print(res[grepl('country', variable)])
  
  cat('- LONG TERM -\n')
  m<-lm(elastlt~as.factor(country)+ as.factor(category) + as.factor(brand), data=elast, subset=country_class=='linc'&variable==var)
  res=data.table(summary(m)$coefficients)
  res[, variable:=rownames(summary(m)$coefficients)]
  print(res[grepl('country', variable)])
  
}
```

# R3: When we look at the same markets and product categories, do western brands have the same marketing elasticities than non-western brands?

not done yet

# R4: Are product categories in different life cycle stages across EMs and DMs and what does this imply for marketing mix elasticities?

to be discussed

# R5: How does competition from unbranded produts affect demand and marketing elasticities in EMs?

to be discussed

# R6: Does the lack of infrastructure in EMs lead to stronger or weaker distribution elasticities? 

# RQ7: Is it true that in EMs, greater standardization (less variety) leads to better financial performance? (line length elasticity smaller in EMs than in DMs?)

```{r rq7, echo = FALSE}
  var = 'llen'

  cat('- SHORT TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elast, elast[country_class=='linc' & variable == var]$elast))
  cat('- LONG TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elastlt, elast[country_class=='linc' & variable == var]$elastlt))

```

# RQ8: Is it true that in EMs, the novelty elasticity is relatively strong? 

```{r rq8, echo = FALSE}
  var = 'nov6sh'

  cat('- SHORT TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elast, elast[country_class=='linc' & variable == var]$elast))
  cat('- LONG TERM -\n')
  print(t.test(elast[country_class=='hinc' & variable == var]$elastlt, elast[country_class=='linc' & variable == var]$elastlt))

```